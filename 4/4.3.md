## システムの構成方法
システムに求められるのは主に、  
 - 処理が速いこと
 - 処理結果に信頼がおけること
 - 障害が発生してもシステムが落ちないこと
 - セキュリティに問題がないこと
など。これらを実現するために様々な方法が取られている。両者を完全に満たす方法はどれか～みたいな考えでなく、コストやどちらがより重要なのか、という観点から選択する。



### 4.3.1 デュアルシステム
ある処理について二つの機体で実施し、定期的に結果を突き合わせて齟齬がないか確認する。突き合わせ確認の分スループットは落ちるが、信頼性が高く、また、片方に障害が発生してももう片方が動いていれば、システムを動かし続けることもできる。機体が複数必要なので、コスト面では嬉しくない。  
高速性よりも信頼性を重視するような場合に使うはず。


### デュプレックスシステム
一方がメインで働いて、もう一方は主に待機＆バッチ処理みたいな即時対応する系ではない処理を行う方式。こちらもメイン機体が落ちても、待機している機体を使えばいいので、信頼性は高い（切り替えに時間は必要だが）。



### ホットスタンバイ方式
デュプレックスの待機系が、メイン側の障害時に即座に切り替われる版。障害検知から切り替えを自動で行うために、監視システムや切り替えのためのシステムも必要。システムではなく、DBだけメインと同期させておいて、障害時に予備のDBに切り替えるウォームスタンバイ方式もある。



### 4.3.3 災害を考慮したシステム構成
 - ホットサイト
   - メインで使われるシステム設置場所と異なる（災害時に同時に被害を受けない）場所にバックアップセンタを設置。
   - 障害時にすぐに切り替えられるようスタンバイしておく

 - コールドサイト
   - 別環境に用意しておくのは上と同じだが、平時は別の目的でシステムを運用し、障害時にバックアップとして使う方式。
   - 予備として遊ばせておくことにはならないので、リソースが無駄になることはないが、障害時の切り替えのタイムギャップや、バックアップとして働いている間は元の働きができないので、普段どのような働きをさせるかも選択が難しいところ（最悪中断することになっても問題ない、別のシステムが引き継いでくれる、など）。


### 4.3.4 信頼性の高いシステムとは？
- フォールトトレランス：そもそも障害が起こることを前提に考えて、障害が起こってもシステム全体は機能し続けるようにするよ。  
   - フェールソフト：障害時の性能劣化は起こるけど、システム全体は止まらないようにしよう。  
   - フェールオーバー：障害時にバックアップが処理を引き継いで、元通りのサービスを提供するよ。
   - フェールセーフ：障害時の被害範囲を最小に保てるようにするよ。（パイプライン的な一連の処理の頭の方でこけたら、その後ろに変なデータ流してDBぶっ壊しました！みたいなのを起こさないように、適当なところでこけるとか）
   - フェールマスキング：障害発生時に、それが外から見えないようにする/元通りに自動で復帰するようにするよ
   - フェールプルーフ：想定外の入力に対して障害が発生したりしないよう、validationを行うなどするよ
フォールトアボイダンス：障害が起こりにくいように機体やシステム構成をえらぶよ。  

どちらがよいという話ではなく、どちらもやる。





### 4.3.5 信頼性と高速化のための技術
 - RAID (Redundant Arrays of Independent Disks)
   - 磁気ディスクを並列に並べて、外側からは一つの磁気ディスクに見えるようにする
   - 容量を増したり、I/Oを高速化したり。
   - 複数の種類がある。
     - ディスクを複数導入し、保存先を分けることでI/O高速化しよう：RAID0。障害時に復旧できないのが困りどころ。
     - ディスクを複数導入し、同じ情報を複数のディスクに書き込んで（ミラーリング）、信頼性を高めよう：RAID1。復旧は可能だが、同じデータを複数保存するので、容量的な問題がある。
     - RAID0では障害発生時にどうしようもないので、エラー訂正用コード（パリティコード）を一緒に保存して、データ復旧を可能にする：RAID3,RAID4（パリティ保管専用のディスクを用意専用）、あまり使われない模様。
     - パリティを一か所にまとめて保管すると、アクセスが集中してスループット落ちるから、パリティも分散してもつよ：RAID5。パリティの保存があるので、書き込みが遅くなるかも。
     - それでも複数台故障すると復旧できなくなるので、パリティを多重に別の場所に保存しておくよ：RAID6。5の時より障害耐性は高いが、パリティ複数書き込みのため、書き込みがさらに遅くなるかも。
     - RAID0 + RAID1 の方法で、高速化で高信頼性にするよ：RAID01(10とも)
 - NAS (Network Attached Storage)
   - ファイルサーバ専用機をネットワークを介して使う感じ。
 - SAN (Storage Area Network)
   - サーバとストレージ専用の高速ネットワーク 